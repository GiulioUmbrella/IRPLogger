
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../irppacket/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.39">
    
    
      
        <title>IRP Packet Parsing - IRPLogger</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8c3ca2c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#irp-packet-parsing" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="IRPLogger" class="md-header__button md-logo" aria-label="IRPLogger" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            IRPLogger
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              IRP Packet Parsing
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="IRPLogger" class="md-nav__button md-logo" aria-label="IRPLogger" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    IRPLogger
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    File Operations Features
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../irplogger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IRPLogger
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../irppacket/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IRP Packet
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    IRP Packet Parsing
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    IRP Packet Parsing
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#parse-irp-packet" class="md-nav__link">
    <span class="md-ellipsis">
      Parse IRP Packet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list-of-features" class="md-nav__link">
    <span class="md-ellipsis">
      List of features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#entropy" class="md-nav__link">
    <span class="md-ellipsis">
      Entropy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-read" class="md-nav__link">
    <span class="md-ellipsis">
      File Read
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-write" class="md-nav__link">
    <span class="md-ellipsis">
      File Write
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-close" class="md-nav__link">
    <span class="md-ellipsis">
      File Close
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#access-frequency" class="md-nav__link">
    <span class="md-ellipsis">
      Access Frequency
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-type-cross-write" class="md-nav__link">
    <span class="md-ellipsis">
      File type cross Write
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-type-cross-rw-file-type-funneling" class="md-nav__link">
    <span class="md-ellipsis">
      File type cross R/W (File type funneling )
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-type-coverage" class="md-nav__link">
    <span class="md-ellipsis">
      File type Coverage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-create" class="md-nav__link">
    <span class="md-ellipsis">
      File Create
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delete" class="md-nav__link">
    <span class="md-ellipsis">
      Delete
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-size-change" class="md-nav__link">
    <span class="md-ellipsis">
      File size change
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#similarity" class="md-nav__link">
    <span class="md-ellipsis">
      Similarity
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-type-change-file-name-change-file-move" class="md-nav__link">
    <span class="md-ellipsis">
      File type change / File name change / File move
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#override-ratio" class="md-nav__link">
    <span class="md-ellipsis">
      Override ratio
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#folder-listing" class="md-nav__link">
    <span class="md-ellipsis">
      Folder listing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#directory-traversal" class="md-nav__link">
    <span class="md-ellipsis">
      Directory Traversal
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#temporary-files" class="md-nav__link">
    <span class="md-ellipsis">
      Temporary Files
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#parse-irp-packet" class="md-nav__link">
    <span class="md-ellipsis">
      Parse IRP Packet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list-of-features" class="md-nav__link">
    <span class="md-ellipsis">
      List of features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#entropy" class="md-nav__link">
    <span class="md-ellipsis">
      Entropy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-read" class="md-nav__link">
    <span class="md-ellipsis">
      File Read
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-write" class="md-nav__link">
    <span class="md-ellipsis">
      File Write
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-close" class="md-nav__link">
    <span class="md-ellipsis">
      File Close
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#access-frequency" class="md-nav__link">
    <span class="md-ellipsis">
      Access Frequency
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-type-cross-write" class="md-nav__link">
    <span class="md-ellipsis">
      File type cross Write
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-type-cross-rw-file-type-funneling" class="md-nav__link">
    <span class="md-ellipsis">
      File type cross R/W (File type funneling )
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-type-coverage" class="md-nav__link">
    <span class="md-ellipsis">
      File type Coverage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-create" class="md-nav__link">
    <span class="md-ellipsis">
      File Create
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delete" class="md-nav__link">
    <span class="md-ellipsis">
      Delete
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-size-change" class="md-nav__link">
    <span class="md-ellipsis">
      File size change
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#similarity" class="md-nav__link">
    <span class="md-ellipsis">
      Similarity
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-type-change-file-name-change-file-move" class="md-nav__link">
    <span class="md-ellipsis">
      File type change / File name change / File move
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#override-ratio" class="md-nav__link">
    <span class="md-ellipsis">
      Override ratio
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#folder-listing" class="md-nav__link">
    <span class="md-ellipsis">
      Folder listing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#directory-traversal" class="md-nav__link">
    <span class="md-ellipsis">
      Directory Traversal
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#temporary-files" class="md-nav__link">
    <span class="md-ellipsis">
      Temporary Files
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="irp-packet-parsing">IRP Packet Parsing</h1>
<p>This page provides details on how to extract relevant features for file operations. Consulte the <a href="../irppacket/">IRP Packet</a> page for a reference on how IRP packets are organized and the <a href="../irplogger/">IRPLogger</a> for an overview of the software for collecting the features. </p>
<h2 id="parse-irp-packet">Parse IRP Packet</h2>
<p><img alt="IRP packet parsing" src="../assets/images/IRP_packet_parsing.png" /></p>
<p>The IRPLogger receives a <code>data</code> frame with a <code>FLT_CALLBACK_DATA</code> structure containing several elements. The most important is a pointer <code>PFLT_IO_PARAMETER_BLOCK Iopb</code>. The Iopb containts pointers to the IRP major function code and FLT_PARAMETERS.</p>
<ol>
<li>Determine the FileInformationClass value</li>
<li>Cast the InfoPointer buffer to the </li>
<li>Use the pointer</li>
</ol>
<p>The following code, extracted from filter/IRPLoggerLog.c, demonstrates how to parse a packet for delete operations. The primary function code used is IRP_MJ_SET_INFORMATION, with additional parameters stored in the FILE_DISPOSITION_INFORMATION structure. For more details, refer to the <a href="../irppacket/">IRP packet</a> page. Consider the following example for the deletion of a file:</p>
<p><div class="language-c highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">Iopb</span><span class="o">-&gt;</span><span class="n">MajorFunction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">IRP_MJ_SET_INFORMATION</span><span class="p">)</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">fileinformationclass</span><span class="p">;</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">        </span><span class="n">fileinformationclass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">-&gt;</span><span class="n">Iopb</span><span class="o">-&gt;</span><span class="n">Parameters</span><span class="p">.</span><span class="n">SetFileInformation</span><span class="p">.</span><span class="n">FileInformationClass</span><span class="p">;</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">        </span><span class="n">record_data</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">SetInformation</span><span class="p">.</span><span class="n">InfoTag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fileinformationclass</span><span class="p">;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fileinformationclass</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">FileDispositionInformation</span><span class="p">)</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">            </span><span class="n">PFILE_DISPOSITION_INFORMATION</span><span class="w"> </span><span class="n">ptr</span><span class="p">;</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">            </span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">PFILE_DISPOSITION_INFORMATION</span><span class="p">)</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">Iopb</span><span class="o">-&gt;</span><span class="n">Parameters</span><span class="p">.</span><span class="n">SetFileInformation</span><span class="p">.</span><span class="n">InfoBuffer</span><span class="p">;</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">            </span><span class="n">record_data</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">SetInformation</span><span class="p">.</span><span class="n">InfoClass</span><span class="p">.</span><span class="n">Delete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ptr</span><span class="o">-&gt;</span><span class="n">DeleteFile</span><span class="p">;</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
The code performs the following operations:</p>
<ol>
<li>Check if the Major code is <code>IRP_MJ_SET_INFORMATION</code></li>
<li>Verify if the fileinformationclass for the FileDispositionInformation. </li>
<li>Declare a PFILE_DISPOSITION_INFORMATION pointer to FILE_DISPOSITION_INFORMATION struct</li>
<li>Cast the InforBuffer to PFILE_DISPOSITION_INFORMATION </li>
<li>Differentiate the pointer to access elements within the FILE_DISPOSITION_INFORMATION structure.</li>
</ol>
<h2 id="list-of-features">List of features</h2>
<p>Total list of features use by the different model.</p>
<ul>
<li>Entropy              </li>
<li>Similarity           </li>
<li>Override ratio       </li>
<li>Delete               </li>
<li>File type cross Write</li>
<li>File type cross R/W  </li>
<li>File type Coverage   </li>
<li>File type change     </li>
<li>File Rename/Move     </li>
<li>File size change     </li>
<li>Access Frequency     </li>
<li>File Create          </li>
<li>File Read            </li>
<li>File Write           </li>
<li>File Close           </li>
<li>Folder listing       </li>
<li>Directory Traversal  </li>
<li>Temporary Files      </li>
</ul>
<p>Some of them can be directly obtained by the logger. Other instead can be derived with some pre-processing operations.</p>
<p>NB: select WHERE to capture the variation, in the log_pre_operation_data or the log_post_operation_data</p>
<h2 id="entropy">Entropy</h2>
<p>Models: Cryptolock  Unveil  ShieldFS  Redemption  RWGuard </p>
<p>To compute Entropy use the shannon's formula on the Buffer of the operation.</p>
<h2 id="file-read">File Read</h2>
<p>Models: ShieldFS |  RWGuard</p>
<blockquote>
<p>The read operation has the Major code IRP_MJ_READ</p>
</blockquote>
<h2 id="file-write">File Write</h2>
<p>Models: ShieldFS |  RWGuard</p>
<blockquote>
<p>The write operation has the Major code IRP_MJ_WRITE</p>
</blockquote>
<h2 id="file-close">File Close</h2>
<p>Models: RWGuard</p>
<blockquote>
<p>The close operation has the Major code IRP_MJ_CLOSE</p>
</blockquote>
<p>Note: this code does not have a parameter field</p>
<h2 id="access-frequency">Access Frequency</h2>
<p>Models: Redemption</p>
<blockquote>
<p>Access frequency is the inverse of elapsed time between two write operation.</p>
</blockquote>
<p>Computes the elapsed time between <strong>two</strong> subsequent <strong>write</strong> requests generated by a <strong>single process</strong> to access <strong>two</strong> different files. </p>
<p><code>Access frequency = 1/elapsed time</code></p>
<p>As the elapsed time between two write requests increases, the access frequency decreases.</p>
<p>By process, monitor each IRP_MJ_WRITE file name. If the file name is different take the elapsed time from the timestamps and do the difference to get the elapsed time.</p>
<h2 id="file-type-cross-write">File type cross Write</h2>
<p>Models: Redemption</p>
<blockquote>
<p>Check if the process requests <strong>write</strong> access to files that belong to different document classes.</p>
</blockquote>
<p>Use the <code>IRP_MJ_WRITE</code> to get file operations and get the file extension from the file name.</p>
<p>Q: what is a document class?
Q: can i extract the document class from the file path?</p>
<h2 id="file-type-cross-rw-file-type-funneling">File type cross R/W  (File type funneling )</h2>
<p>Models: Cryptolock</p>
<blockquote>
<p>Check if the number of file types in input is higher than the number of file types in output</p>
</blockquote>
<p>File in input:  <code>IRP_MJ_READ</code> and filename to extract the extension from the string
File in output: <code>IRP_MJ_WRITE</code> and filename to extract the extension from the string</p>
<h2 id="file-type-coverage">File type Coverage</h2>
<p>Models: ShieldFS</p>
<blockquote>
<p>Check the percentage of accessed files by file extension</p>
</blockquote>
<p>Ordinary processes only access a small number of files by type, ransomwares try to access all of them.</p>
<p>Q: What does it mean <strong>accessed</strong>? Is it a READ, a WRITE or BOTH?</p>
<h2 id="file-create">File Create</h2>
<p>Models: RWGuard</p>
<p>Check the <code>IRP_MJ_CREATE</code> major code</p>
<!-- ### Expanded version

IRPLogger must be expanded to consider the following features

- Delete               
- File size change     
- Similarity            -->

<h2 id="delete">Delete</h2>
<p>Models: Cryptolock Redemption</p>
<blockquote>
<p>Relevant codes are IRP_MJ_CREATE and IRP_MJ_SET_INFORMATION</p>
</blockquote>
<p>FileDispositionInformationEx = 64,</p>
<p>Monitor if the process deletes a file</p>
<p><a href="https://stackoverflow.com/questions/50870373/what-is-the-irp-message-generated-on-file-delete-in-a-filter-driver">reference</a></p>
<p><strong>IRP_MJ_CREATE</strong></p>
<p>For the Major code <code>IRP_MJ_CREATE</code> check the flag FILE_DELETE_ON_CLOSE</p>
<p>data-&gt;Iopb-&gt;MajorFunction  ==  IRP_MJ_CREATE
data-&gt;Iopb-&gt;Parameters.Create.Options == FILE_DELETE_ON_CLOSE</p>
<p><strong>IRP_MJ_SET_INFORMATION</strong></p>
<p>For the Major code <code>IRP_MJ_SET_INFORMATION</code> check if the PFILE_DISPOSITION_INFORMATION flag is of type DeleteFile</p>
<p>data-&gt;Iopb-&gt;MajorFunction  == IRP_MJ_SET_INFORMATION
data-&gt;Iopb-&gt;Parameters.SetFileInformation.FileInformationClass == FILE_DISPOSITION_INFORMATION</p>
<p>FILE_DISPOSITION_INFORMATION.DeleteFile == True</p>
<p>PROBLEMA: i file iniziano ad avere componenti diverse</p>
<h2 id="file-size-change">File size change</h2>
<p>Models: RWGuard</p>
<p>Q1: how do you find the old file size? With a CREATE ? Or With a READ
Q2: How do you find the new file siez? Witha WRITE ?</p>
<p>https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/ns-wdm-_file_standard_information
https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-zwqueryinformationfile</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ntddk.h&gt;</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">NTSTATUS</span><span class="w"> </span><span class="nf">GetFileSize</span><span class="p">(</span><span class="n">PFILE_OBJECT</span><span class="w"> </span><span class="n">FileObject</span><span class="p">,</span><span class="w"> </span><span class="n">PLARGE_INTEGER</span><span class="w"> </span><span class="n">FileSize</span><span class="p">)</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="p">{</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="n">NTSTATUS</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="n">IO_STATUS_BLOCK</span><span class="w"> </span><span class="n">ioStatusBlock</span><span class="p">;</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">    </span><span class="n">FILE_STANDARD_INFORMATION</span><span class="w"> </span><span class="n">fileInfo</span><span class="p">;</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">FileObject</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">FileSize</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">STATUS_INVALID_PARAMETER</span><span class="p">;</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZwQueryInformationFile</span><span class="p">(</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">        </span><span class="n">FileObject</span><span class="p">,</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">        </span><span class="o">&amp;</span><span class="n">ioStatusBlock</span><span class="p">,</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">        </span><span class="o">&amp;</span><span class="n">fileInfo</span><span class="p">,</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="w">        </span><span class="k">sizeof</span><span class="p">(</span><span class="n">FILE_STANDARD_INFORMATION</span><span class="p">),</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="w">        </span><span class="n">FileStandardInformation</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">NT_SUCCESS</span><span class="p">(</span><span class="n">status</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="w">        </span><span class="o">*</span><span class="n">FileSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fileInfo</span><span class="p">.</span><span class="n">EndOfFile</span><span class="p">;</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="p">}</span>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a>
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="kt">void</span><span class="w"> </span><span class="nf">ExampleUsage</span><span class="p">(</span><span class="n">PDEVICE_OBJECT</span><span class="w"> </span><span class="n">DeviceObject</span><span class="p">,</span><span class="w"> </span><span class="n">PIRP</span><span class="w"> </span><span class="n">Irp</span><span class="p">)</span>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="p">{</span>
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a><span class="w">    </span><span class="n">PIO_STACK_LOCATION</span><span class="w"> </span><span class="n">irpSp</span><span class="p">;</span>
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="w">    </span><span class="n">PFILE_OBJECT</span><span class="w"> </span><span class="n">fileObject</span><span class="p">;</span>
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="w">    </span><span class="n">LARGE_INTEGER</span><span class="w"> </span><span class="n">fileSize</span><span class="p">;</span>
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a><span class="w">    </span><span class="n">NTSTATUS</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a>
</span><span id="__span-1-35"><a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a><span class="w">    </span><span class="n">irpSp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IoGetCurrentIrpStackLocation</span><span class="p">(</span><span class="n">Irp</span><span class="p">);</span>
</span><span id="__span-1-36"><a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a><span class="w">    </span><span class="n">fileObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">irpSp</span><span class="o">-&gt;</span><span class="n">FileObject</span><span class="p">;</span>
</span><span id="__span-1-37"><a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a>
</span><span id="__span-1-38"><a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fileObject</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-39"><a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a><span class="w">        </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetFileSize</span><span class="p">(</span><span class="n">fileObject</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fileSize</span><span class="p">);</span>
</span><span id="__span-1-40"><a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">NT_SUCCESS</span><span class="p">(</span><span class="n">status</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-41"><a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a><span class="w">            </span><span class="n">DbgPrint</span><span class="p">(</span><span class="s">&quot;File size: %lld bytes</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fileSize</span><span class="p">.</span><span class="n">QuadPart</span><span class="p">);</span>
</span><span id="__span-1-42"><a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-43"><a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a><span class="w">            </span><span class="n">DbgPrint</span><span class="p">(</span><span class="s">&quot;Failed to get file size: %08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">);</span>
</span><span id="__span-1-44"><a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-1-45"><a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-1-46"><a id="__codelineno-1-46" name="__codelineno-1-46" href="#__codelineno-1-46"></a>
</span><span id="__span-1-47"><a id="__codelineno-1-47" name="__codelineno-1-47" href="#__codelineno-1-47"></a><span class="w">    </span><span class="c1">// Continue processing the IRP...</span>
</span><span id="__span-1-48"><a id="__codelineno-1-48" name="__codelineno-1-48" href="#__codelineno-1-48"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="similarity">Similarity</h2>
<p>Models: Cryptolock Redemption</p>
<blockquote>
<p>sdhash</p>
</blockquote>
<p>For the time being in stand-by</p>
<!-- ### To Check

- File type change     
- File Rename/Move     
- Override ratio       
- Folder listing       
- Directory Traversal  
- Temporary Files       -->

<h2 id="file-type-change-file-name-change-file-move">File type change / File name change / File move</h2>
<p><strong>NB</strong> for all of this we just simply observe change in the file path.</p>
<p>Models: Cryptolock RWGuard</p>
<ul>
<li>Cryptolock: just monitor the file type change</li>
<li>RW_GUARD:  Ransomwares change the file type <strong>after</strong> encryption. Monitor the file type change before and after a write operation</li>
</ul>
<blockquote>
<p>IRP packet: IRP_MJ_SET_INFORMATION </p>
</blockquote>
<p>Place the capture in the <code>log_post_operation_data</code> function in the filter space. </p>
<p>File rename is communicated with a <code>IRP_MJ_SET_INFORMATION</code> packet. The FLT_PARAMETERS struct associated with this IRP is is the <code>SetFileInformation</code>. This contains a <code>FILE_INFORMATION_CLASS FileInformationClass</code> enumeration with value <code>FileRenameInformation</code>. The actual values of the IRP can be accessed using the <code>PVOID InfoBuffer</code>. </p>
<p>The parameter of the IRP are defined in a <a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/ns-ntifs-_file_rename_information"><code>FILE_RENAME_INFORMATION struct</code></a>. The value of interest are the</p>
<ul>
<li>ULONG FileNameLength;</li>
<li>WCHAR FileName[1];<ul>
<li><strong>NB</strong>: FILE_INFORMATION_CLASS is an enumeration specifying which values are accessible through the PVOID InfoBuffer. In the pre and post function we do <strong>not</strong> access a FILE_RENAME_INFORMATION struct directly.  </li>
</ul>
</li>
</ul>
<p>To store the value we use a struct 
<div class="language-c highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="n">ULONG</span><span class="w"> </span><span class="n">FileNameLength</span><span class="p">;</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="n">WCHAR</span><span class="w"> </span><span class="n">NewName</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="p">}</span><span class="w"> </span><span class="n">Filename</span>
</span></code></pre></div>
Q: the docs says FileName[1] is the first character in memory so it should be of type WCHAR. How can I cast into a pointer?</p>
<p>Todo: add memory consideration
Todo: add allineation consideration</p>
<p>In the filter space we copy the buffer with the <a href="https://learn.microsoft.com/it-it/cpp/c-runtime-library/reference/strcpy-s-wcscpy-s-mbscpy-s?view=msvc-170">wcscpy</a>, analogus to the strcpy function. </p>
<p>Likewise, to <strong>print</strong> the path on log file we use the <a href="https://learn.microsoft.com/it-it/cpp/c-runtime-library/reference/fprintf-fprintf-l-fwprintf-fwprintf-l?view=msvc-170">fwprintf</a> function. Note that the format parameter must be of type WCHAR with parameter <code>%ls</code>. Simply use <code>L"%ls"</code> as parameter.</p>
<p><strong>Example:</strong></p>
<p>Note: The simrep project contains some examples of the InfoBuffer</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">PFILE_RENAME_INFORMATION</span><span class="w"> </span><span class="n">renameInfo</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">renameInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cbd</span><span class="o">-&gt;</span><span class="n">Iopb</span><span class="o">-&gt;</span><span class="n">Parameters</span><span class="p">.</span><span class="n">SetFileInformation</span><span class="p">.</span><span class="n">InfoBuffer</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">            </span><span class="n">setInfo</span><span class="p">.</span><span class="n">RootDirectory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">renameInfo</span><span class="o">-&gt;</span><span class="n">RootDirectory</span><span class="p">;</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">            </span><span class="n">setInfo</span><span class="p">.</span><span class="n">FileNameLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">renameInfo</span><span class="o">-&gt;</span><span class="n">FileNameLength</span><span class="p">;</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">            </span><span class="n">setInfo</span><span class="p">.</span><span class="n">FileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">renameInfo</span><span class="o">-&gt;</span><span class="n">FileName</span><span class="p">;</span>
</span></code></pre></div>
<p><strong>Educated guess</strong></p>
<p>Note that the Window documentation page of IRP_MJ_SET_INFORMATION packets is inside the legacy filter technology while in this work we are using the Minifilter technology. The FileInformationClass for the legacy it is accessible through a pointer to the IRP, while for the Minifilter we use the InfoBuffer pointer.</p>
<p>The documentation for the minifilter does not specifies the contents of InfoBuffer, it just states that "it Pointer to an input buffer that contains the file information to be set". Given the available exemples, we assume that the contents of the buffer are specified by the <code>FileInformationClass</code> associated with the operation.</p>
<h2 id="override-ratio">Override ratio</h2>
<p>Models: Redemption</p>
<p>Verify which percentage of the file is overwritten.</p>
<ul>
<li>sA file size </li>
<li>yA is the total size of the data blocks modified by the process</li>
</ul>
<p>Override ratio is calculated as yA/ sA </p>
<p>| where the higher the number of data blocks modified by the process, the closer the value is to 1.
| even if file is overwritten with the same content it counts as a overwrite. This feature does not consider the contents like similarity.</p>
<p>Q: how many write operations</p>
<h2 id="folder-listing">Folder listing</h2>
<p><a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ifs/irp-mj-directory-control">Description</a></p>
<p>Models ShieldFS</p>
<blockquote>
<p>Major IRP_MJ_DIRECTORY_CONTROL Minor IRP_MN_QUERY_DIRECTORY</p>
</blockquote>
<p>Number of folder-listing operations normalized by the total number of folders in the system.</p>
<p>The actual request depends on a FileInformation filed
ToDO: cl</p>
<table>
<thead>
<tr>
<th>FileInformationClass</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>FileBothDirectoryInformation</td>
<td>FILE_BOTH_DIR_INFORMATION struct for each file.</td>
</tr>
<tr>
<td>FileDirectoryInformation</td>
<td>FILE_DIRECTORY_INFORMATION struct for each file.</td>
</tr>
<tr>
<td>FileFullDirectoryInformation</td>
<td>FILE_FULL_DIR_INFORMATION struct for each file.</td>
</tr>
<tr>
<td>FileIdBothDirectoryInformation</td>
<td>FILE_ID_BOTH_DIR_INFORMATION struct for each file.</td>
</tr>
<tr>
<td>FileIdFullDirectoryInformation</td>
<td>FILE_ID_FULL_DIR_INFORMATION struct for each file.</td>
</tr>
<tr>
<td>FileNamesInformation</td>
<td>FILE_NAMES_INFORMATION struct for each file.</td>
</tr>
<tr>
<td>FileObjectIdInformation</td>
<td>FILE_OBJECTID_INFORMATION struct for each file.</td>
</tr>
<tr>
<td>FileReparsePointInformation</td>
<td>single FILE_REPARSE_POINT_INFORMATION struct for the directory.</td>
</tr>
</tbody>
</table>
<h2 id="directory-traversal">Directory Traversal</h2>
<p>Models Redemption</p>
<p>Redemption monitors if the process traverses over the user files with write privilege, and computes the additive inverse of the number of privileged accesses to unique files in a given path. </p>
<h2 id="temporary-files">Temporary Files</h2>
<p>Models RWGuard</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.525ec568.min.js"></script>
      
    
  </body>
</html>